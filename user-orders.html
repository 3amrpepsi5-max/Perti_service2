<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
<meta charset="UTF-8">
<title>طلباتي - النزهة 2</title>
<link rel="stylesheet" href="../css/styles.css">
<link rel="stylesheet" href="../css/user-dashboard.css">
</head>
<body>

<div class="dashboard-container">
<main class="dashboard-main">

<h1>طلباتي</h1>

<div id="orders-container" class="card"></div>

</main>
</div>

<script type="module">
import API from '../js/api-client.js';

async function loadOrders() {
  const res = await API.Orders.getMyOrders();
  const orders = res.data;

  const container = document.getElementById('orders-container');

  if (!orders.length) {
    container.innerHTML = '<p>لا توجد طلبات.</p>';
    return;
  }

  container.innerHTML = orders.map(o=>`
    <div class="card" style="margin-bottom:20px;">
      <h3>#${o.id} - ${o.service}</h3>
      <p>الحالة: ${o.status}</p>
      <p>التاريخ: ${new Date(o.createdAt).toLocaleDateString('ar-EG')}</p>
      ${o.status === 'pending' ? `
        <button onclick="cancelOrder(${o.id})" class="button">
          إلغاء الطلب
        </button>` : ''}
    </div>
  `).join('');
}

window.cancelOrder = async function(id){
  if(confirm('هل تريد إلغاء الطلب؟')){
    await API.Orders.cancel(id);
    loadOrders();
  }
}

loadOrders();
</script>

</body>
</html>