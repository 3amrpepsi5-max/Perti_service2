/**
 * â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
 * ğŸ“§ Email Service
 * Ø®Ø¯Ù…Ø© Ø¥Ø±Ø³Ø§Ù„ Ø§Ù„Ø¨Ø±ÙŠØ¯ Ø§Ù„Ø¥Ù„ÙƒØªØ±ÙˆÙ†ÙŠ
 * â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
 */

const nodemailer = require('nodemailer');
require('dotenv').config();

class EmailService {
  
  constructor() {
    // Create transporter
    this.transporter = nodemailer.createTransporter({
      host: process.env.SMTP_HOST || 'smtp.gmail.com',
      port: process.env.SMTP_PORT || 587,
      secure: process.env.SMTP_SECURE === 'true', // true for 465, false for other ports
      auth: {
        user: process.env.SMTP_USER,
        pass: process.env.SMTP_PASS
      }
    });
    
    // Default from address
    this.fromAddress = process.env.SMTP_FROM || 'noreply@nozha2.com';
    this.fromName = process.env.SMTP_FROM_NAME || 'Nozha 2';
  }
  
  // â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
  // CORE FUNCTIONS
  // â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
  
  /**
   * Send email
   */
  async sendEmail({ to, subject, html, text, attachments = [] }) {
    try {
      const mailOptions = {
        from: `"${this.fromName}" <${this.fromAddress}>`,
        to,
        subject,
        text,
        html,
        attachments
      };
      
      const info = await this.transporter.sendMail(mailOptions);
      
      console.log('âœ… Email sent:', info.messageId);
      return {
        success: true,
        messageId: info.messageId
      };
      
    } catch (error) {
      console.error('âŒ Email sending failed:', error.message);
      return {
        success: false,
        error: error.message
      };
    }
  }
  
  /**
   * Verify transporter connection
   */
  async verifyConnection() {
    try {
      await this.transporter.verify();
      console.log('âœ… Email service ready');
      return true;
    } catch (error) {
      console.error('âŒ Email service error:', error.message);
      return false;
    }
  }
  
  // â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
  // AUTHENTICATION EMAILS
  // â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
  
  /**
   * Send welcome email
   */
  async sendWelcomeEmail(user) {
    const subject = 'Ù…Ø±Ø­Ø¨Ø§Ù‹ Ø¨Ùƒ ÙÙŠ Ù†Ø²Ù‡Ø© 2 - Welcome to Nozha 2';
    
    const html = `
      <!DOCTYPE html>
      <html dir="rtl" lang="ar">
      <head>
        <meta charset="UTF-8">
        <style>
          body { font-family: 'Arial', sans-serif; background-color: #f5f5f5; padding: 20px; }
          .container { max-width: 600px; margin: 0 auto; background: white; border-radius: 10px; padding: 30px; }
          .header { text-align: center; padding: 20px 0; border-bottom: 2px solid #4CAF50; }
          .header h1 { color: #4CAF50; margin: 0; }
          .content { padding: 30px 0; }
          .button { display: inline-block; padding: 12px 30px; background: #4CAF50; color: white; text-decoration: none; border-radius: 5px; margin: 20px 0; }
          .footer { text-align: center; padding: 20px; color: #666; font-size: 12px; border-top: 1px solid #eee; margin-top: 30px; }
        </style>
      </head>
      <body>
        <div class="container">
          <div class="header">
            <h1>ğŸ‰ Ù…Ø±Ø­Ø¨Ø§Ù‹ Ø¨Ùƒ ÙÙŠ Ù†Ø²Ù‡Ø© 2</h1>
          </div>
          <div class="content">
            <h2>Ù…Ø±Ø­Ø¨Ø§Ù‹ ${user.name}ØŒ</h2>
            <p>Ø´ÙƒØ±Ø§Ù‹ Ù„Ø§Ù†Ø¶Ù…Ø§Ù…Ùƒ Ø¥Ù„Ù‰ Ù…Ù†ØµØ© Ù†Ø²Ù‡Ø© 2 Ù„Ù„Ø®Ø¯Ù…Ø§Øª Ø§Ù„Ù…Ù†Ø²Ù„ÙŠØ©!</p>
            <p>Ù†Ø­Ù† Ø³Ø¹Ø¯Ø§Ø¡ Ø¨ÙˆØ¬ÙˆØ¯Ùƒ Ù…Ø¹Ù†Ø§. ÙŠÙ…ÙƒÙ†Ùƒ Ø§Ù„Ø¢Ù† Ø§Ù„ÙˆØµÙˆÙ„ Ø¥Ù„Ù‰ Ù…Ø¦Ø§Øª Ø§Ù„Ø®Ø¯Ù…Ø§Øª ÙˆØ§Ù„Ù…Ø²ÙˆØ¯ÙŠÙ† ÙÙŠ Ù…Ù†Ø·Ù‚ØªÙƒ.</p>
            <p>Ø§Ø¨Ø¯Ø£ Ø§Ù„Ø¢Ù† Ø¨ØªØµÙØ­ Ø§Ù„Ø®Ø¯Ù…Ø§Øª Ø§Ù„Ù…ØªØ§Ø­Ø©:</p>
            <center>
              <a href="${process.env.APP_URL || 'http://localhost:3000'}" class="button">ØªØµÙØ­ Ø§Ù„Ø®Ø¯Ù…Ø§Øª</a>
            </center>
            <p>Ø¥Ø°Ø§ ÙƒØ§Ù† Ù„Ø¯ÙŠÙƒ Ø£ÙŠ Ø§Ø³ØªÙØ³Ø§Ø±ØŒ Ù„Ø§ ØªØªØ±Ø¯Ø¯ ÙÙŠ Ø§Ù„ØªÙˆØ§ØµÙ„ Ù…Ø¹Ù†Ø§.</p>
            <p>ØªØ­ÙŠØ§ØªÙ†Ø§ØŒ<br>ÙØ±ÙŠÙ‚ Ù†Ø²Ù‡Ø© 2</p>
          </div>
          <div class="footer">
            <p>Â© 2024 Nozha 2. Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø­Ù‚ÙˆÙ‚ Ù…Ø­ÙÙˆØ¸Ø©.</p>
            <p>Ù‡Ø°Ø§ Ø§Ù„Ø¨Ø±ÙŠØ¯ ØªÙ… Ø¥Ø±Ø³Ø§Ù„Ù‡ Ø¥Ù„Ù‰ ${user.email}</p>
          </div>
        </div>
      </body>
      </html>
    `;
    
    return await this.sendEmail({
      to: user.email,
      subject,
      html,
      text: `Ù…Ø±Ø­Ø¨Ø§Ù‹ ${user.name}ØŒ Ø´ÙƒØ±Ø§Ù‹ Ù„Ø§Ù†Ø¶Ù…Ø§Ù…Ùƒ Ø¥Ù„Ù‰ Ù…Ù†ØµØ© Ù†Ø²Ù‡Ø© 2!`
    });
  }
  
  /**
   * Send email verification
   */
  async sendEmailVerification(user, verificationToken) {
    const verificationUrl = `${process.env.APP_URL}/verify-email?token=${verificationToken}`;
    const subject = 'ØªØ£ÙƒÙŠØ¯ Ø§Ù„Ø¨Ø±ÙŠØ¯ Ø§Ù„Ø¥Ù„ÙƒØªØ±ÙˆÙ†ÙŠ - Email Verification';
    
    const html = `
      <!DOCTYPE html>
      <html dir="rtl" lang="ar">
      <head>
        <meta charset="UTF-8">
        <style>
          body { font-family: 'Arial', sans-serif; background-color: #f5f5f5; padding: 20px; }
          .container { max-width: 600px; margin: 0 auto; background: white; border-radius: 10px; padding: 30px; }
          .header { text-align: center; padding: 20px 0; }
          .content { padding: 20px 0; }
          .button { display: inline-block; padding: 15px 40px; background: #2196F3; color: white; text-decoration: none; border-radius: 5px; margin: 20px 0; font-weight: bold; }
          .code { background: #f0f0f0; padding: 15px; text-align: center; font-size: 24px; letter-spacing: 5px; margin: 20px 0; border-radius: 5px; }
          .footer { text-align: center; padding: 20px; color: #666; font-size: 12px; border-top: 1px solid #eee; margin-top: 30px; }
        </style>
      </head>
      <body>
        <div class="container">
          <div class="header">
            <h1>âœ‰ï¸ ØªØ£ÙƒÙŠØ¯ Ø§Ù„Ø¨Ø±ÙŠØ¯ Ø§Ù„Ø¥Ù„ÙƒØªØ±ÙˆÙ†ÙŠ</h1>
          </div>
          <div class="content">
            <h2>Ù…Ø±Ø­Ø¨Ø§Ù‹ ${user.name}ØŒ</h2>
            <p>Ø´ÙƒØ±Ø§Ù‹ Ù„ØªØ³Ø¬ÙŠÙ„Ùƒ ÙÙŠ Ù†Ø²Ù‡Ø© 2. ÙŠØ±Ø¬Ù‰ ØªØ£ÙƒÙŠØ¯ Ø¨Ø±ÙŠØ¯Ùƒ Ø§Ù„Ø¥Ù„ÙƒØªØ±ÙˆÙ†ÙŠ Ø¨Ø§Ù„Ù†Ù‚Ø± Ø¹Ù„Ù‰ Ø§Ù„Ø²Ø± Ø£Ø¯Ù†Ø§Ù‡:</p>
            <center>
              <a href="${verificationUrl}" class="button">ØªØ£ÙƒÙŠØ¯ Ø§Ù„Ø¨Ø±ÙŠØ¯ Ø§Ù„Ø¥Ù„ÙƒØªØ±ÙˆÙ†ÙŠ</a>
            </center>
            <p>Ø£Ùˆ ÙŠÙ…ÙƒÙ†Ùƒ Ù†Ø³Ø® Ø§Ù„Ø±Ø§Ø¨Ø· Ø§Ù„ØªØ§Ù„ÙŠ ÙˆÙ„ØµÙ‚Ù‡ ÙÙŠ Ø§Ù„Ù…ØªØµÙØ­:</p>
            <p style="word-break: break-all; color: #666;">${verificationUrl}</p>
            <p><strong>Ù…Ù„Ø§Ø­Ø¸Ø©:</strong> Ù‡Ø°Ø§ Ø§Ù„Ø±Ø§Ø¨Ø· ØµØ§Ù„Ø­ Ù„Ù…Ø¯Ø© 24 Ø³Ø§Ø¹Ø© ÙÙ‚Ø·.</p>
            <p>Ø¥Ø°Ø§ Ù„Ù… ØªÙ‚Ù… Ø¨Ø¥Ù†Ø´Ø§Ø¡ Ø­Ø³Ø§Ø¨ØŒ ÙŠÙ…ÙƒÙ†Ùƒ ØªØ¬Ø§Ù‡Ù„ Ù‡Ø°Ø§ Ø§Ù„Ø¨Ø±ÙŠØ¯.</p>
          </div>
          <div class="footer">
            <p>Â© 2024 Nozha 2. Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø­Ù‚ÙˆÙ‚ Ù…Ø­ÙÙˆØ¸Ø©.</p>
          </div>
        </div>
      </body>
      </html>
    `;
    
    return await this.sendEmail({
      to: user.email,
      subject,
      html,
      text: `ØªØ£ÙƒÙŠØ¯ Ø§Ù„Ø¨Ø±ÙŠØ¯ Ø§Ù„Ø¥Ù„ÙƒØªØ±ÙˆÙ†ÙŠ: ${verificationUrl}`
    });
  }
  
  /**
   * Send password reset email
   */
  async sendPasswordReset(user, resetToken) {
    const resetUrl = `${process.env.APP_URL}/reset-password?token=${resetToken}`;
    const subject = 'Ø¥Ø¹Ø§Ø¯Ø© ØªØ¹ÙŠÙŠÙ† ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ± - Password Reset';
    
    const html = `
      <!DOCTYPE html>
      <html dir="rtl" lang="ar">
      <head>
        <meta charset="UTF-8">
        <style>
          body { font-family: 'Arial', sans-serif; background-color: #f5f5f5; padding: 20px; }
          .container { max-width: 600px; margin: 0 auto; background: white; border-radius: 10px; padding: 30px; }
          .header { text-align: center; padding: 20px 0; }
          .content { padding: 20px 0; }
          .button { display: inline-block; padding: 15px 40px; background: #FF5722; color: white; text-decoration: none; border-radius: 5px; margin: 20px 0; font-weight: bold; }
          .warning { background: #fff3cd; padding: 15px; border-right: 4px solid #ffc107; margin: 20px 0; }
          .footer { text-align: center; padding: 20px; color: #666; font-size: 12px; border-top: 1px solid #eee; margin-top: 30px; }
        </style>
      </head>
      <body>
        <div class="container">
          <div class="header">
            <h1>ğŸ” Ø¥Ø¹Ø§Ø¯Ø© ØªØ¹ÙŠÙŠÙ† ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ±</h1>
          </div>
          <div class="content">
            <h2>Ù…Ø±Ø­Ø¨Ø§Ù‹ ${user.name}ØŒ</h2>
            <p>ØªÙ„Ù‚ÙŠÙ†Ø§ Ø·Ù„Ø¨Ø§Ù‹ Ù„Ø¥Ø¹Ø§Ø¯Ø© ØªØ¹ÙŠÙŠÙ† ÙƒÙ„Ù…Ø© Ù…Ø±ÙˆØ± Ø­Ø³Ø§Ø¨Ùƒ. Ø§Ù†Ù‚Ø± Ø¹Ù„Ù‰ Ø§Ù„Ø²Ø± Ø£Ø¯Ù†Ø§Ù‡ Ù„Ø¥Ø¹Ø§Ø¯Ø© ØªØ¹ÙŠÙŠÙ† ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ±:</p>
            <center>
              <a href="${resetUrl}" class="button">Ø¥Ø¹Ø§Ø¯Ø© ØªØ¹ÙŠÙŠÙ† ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ±</a>
            </center>
            <div class="warning">
              <strong>âš ï¸ ØªÙ†Ø¨ÙŠÙ‡ Ø£Ù…Ù†ÙŠ:</strong>
              <p>Ù‡Ø°Ø§ Ø§Ù„Ø±Ø§Ø¨Ø· ØµØ§Ù„Ø­ Ù„Ù…Ø¯Ø© Ø³Ø§Ø¹Ø© ÙˆØ§Ø­Ø¯Ø© ÙÙ‚Ø·. Ø¥Ø°Ø§ Ù„Ù… ØªØ·Ù„Ø¨ Ø¥Ø¹Ø§Ø¯Ø© ØªØ¹ÙŠÙŠÙ† ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ±ØŒ ÙŠØ±Ø¬Ù‰ ØªØ¬Ø§Ù‡Ù„ Ù‡Ø°Ø§ Ø§Ù„Ø¨Ø±ÙŠØ¯.</p>
            </div>
            <p>Ù„Ù„Ø£Ù…Ø§Ù†ØŒ Ù„Ù† Ù†Ø·Ù„Ø¨ Ù…Ù†Ùƒ Ø£Ø¨Ø¯Ø§Ù‹ ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ± Ø¹Ø¨Ø± Ø§Ù„Ø¨Ø±ÙŠØ¯ Ø§Ù„Ø¥Ù„ÙƒØªØ±ÙˆÙ†ÙŠ.</p>
          </div>
          <div class="footer">
            <p>Â© 2024 Nozha 2. Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø­Ù‚ÙˆÙ‚ Ù…Ø­ÙÙˆØ¸Ø©.</p>
          </div>
        </div>
      </body>
      </html>
    `;
    
    return await this.sendEmail({
      to: user.email,
      subject,
      html,
      text: `Ø¥Ø¹Ø§Ø¯Ø© ØªØ¹ÙŠÙŠÙ† ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ±: ${resetUrl}`
    });
  }
  
  // â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
  // ORDER EMAILS
  // â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
  
  /**
   * Send order confirmation email
   */
  async sendOrderConfirmation(order, user) {
    const subject = `ØªØ£ÙƒÙŠØ¯ Ø§Ù„Ø·Ù„Ø¨ #${order.order_number}`;
    
    const html = `
      <!DOCTYPE html>
      <html dir="rtl" lang="ar">
      <head>
        <meta charset="UTF-8">
        <style>
          body { font-family: 'Arial', sans-serif; background-color: #f5f5f5; padding: 20px; }
          .container { max-width: 600px; margin: 0 auto; background: white; border-radius: 10px; padding: 30px; }
          .header { text-align: center; padding: 20px 0; background: #4CAF50; color: white; border-radius: 10px 10px 0 0; margin: -30px -30px 20px; }
          .order-details { background: #f9f9f9; padding: 20px; border-radius: 5px; margin: 20px 0; }
          .detail-row { display: flex; justify-content: space-between; padding: 10px 0; border-bottom: 1px solid #eee; }
          .total { font-size: 18px; font-weight: bold; color: #4CAF50; }
          .footer { text-align: center; padding: 20px; color: #666; font-size: 12px; border-top: 1px solid #eee; margin-top: 30px; }
        </style>
      </head>
      <body>
        <div class="container">
          <div class="header">
            <h1>âœ… ØªÙ… ØªØ£ÙƒÙŠØ¯ Ø·Ù„Ø¨Ùƒ</h1>
          </div>
          <div class="content">
            <h2>Ù…Ø±Ø­Ø¨Ø§Ù‹ ${user.name}ØŒ</h2>
            <p>Ø´ÙƒØ±Ø§Ù‹ Ù„Ùƒ! ØªÙ… ØªØ£ÙƒÙŠØ¯ Ø·Ù„Ø¨Ùƒ Ø¨Ù†Ø¬Ø§Ø­.</p>
            <div class="order-details">
              <h3>ØªÙØ§ØµÙŠÙ„ Ø§Ù„Ø·Ù„Ø¨:</h3>
              <div class="detail-row">
                <span>Ø±Ù‚Ù… Ø§Ù„Ø·Ù„Ø¨:</span>
                <strong>${order.order_number}</strong>
              </div>
              <div class="detail-row">
                <span>Ø§Ù„Ù…Ø²ÙˆØ¯:</span>
                <strong>${order.vendor_name}</strong>
              </div>
              <div class="detail-row">
                <span>Ø§Ù„ØªØ§Ø±ÙŠØ® Ø§Ù„Ù…Ø­Ø¯Ø¯:</span>
                <strong>${order.scheduled_date || 'ØºÙŠØ± Ù…Ø­Ø¯Ø¯'}</strong>
              </div>
              <div class="detail-row">
                <span>Ø§Ù„Ù…Ø¨Ù„Øº:</span>
                <strong>${order.amount} Ø¬Ù†ÙŠÙ‡</strong>
              </div>
              ${order.delivery_fee > 0 ? `
              <div class="detail-row">
                <span>Ø±Ø³ÙˆÙ… Ø§Ù„ØªÙˆØµÙŠÙ„:</span>
                <strong>${order.delivery_fee} Ø¬Ù†ÙŠÙ‡</strong>
              </div>
              ` : ''}
              <div class="detail-row total">
                <span>Ø§Ù„Ù…Ø¬Ù…ÙˆØ¹:</span>
                <strong>${order.total} Ø¬Ù†ÙŠÙ‡</strong>
              </div>
            </div>
            <p>Ø³ÙŠØªÙ… Ø§Ù„ØªÙˆØ§ØµÙ„ Ù…Ø¹Ùƒ Ù‚Ø±ÙŠØ¨Ø§Ù‹ Ù…Ù† Ù‚Ø¨Ù„ Ø§Ù„Ù…Ø²ÙˆØ¯ Ù„ØªØ£ÙƒÙŠØ¯ ØªÙØ§ØµÙŠÙ„ Ø§Ù„Ø®Ø¯Ù…Ø©.</p>
          </div>
          <div class="footer">
            <p>Â© 2024 Nozha 2. Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø­Ù‚ÙˆÙ‚ Ù…Ø­ÙÙˆØ¸Ø©.</p>
          </div>
        </div>
      </body>
      </html>
    `;
    
    return await this.sendEmail({
      to: user.email,
      subject,
      html,
      text: `ØªÙ… ØªØ£ÙƒÙŠØ¯ Ø·Ù„Ø¨Ùƒ Ø±Ù‚Ù… ${order.order_number}`
    });
  }
  
  /**
   * Send order status update email
   */
  async sendOrderStatusUpdate(order, user, status) {
    const statusMessages = {
      confirmed: 'ØªÙ… ØªØ£ÙƒÙŠØ¯ Ø·Ù„Ø¨Ùƒ',
      in_progress: 'Ø¬Ø§Ø±ÙŠ ØªÙ†ÙÙŠØ° Ø·Ù„Ø¨Ùƒ',
      completed: 'ØªÙ… Ø¥ÙƒÙ…Ø§Ù„ Ø·Ù„Ø¨Ùƒ',
      cancelled: 'ØªÙ… Ø¥Ù„ØºØ§Ø¡ Ø·Ù„Ø¨Ùƒ'
    };
    
    const subject = `${statusMessages[status]} - Ø·Ù„Ø¨ #${order.order_number}`;
    
    const html = `
      <!DOCTYPE html>
      <html dir="rtl" lang="ar">
      <head>
        <meta charset="UTF-8">
        <style>
          body { font-family: 'Arial', sans-serif; background-color: #f5f5f5; padding: 20px; }
          .container { max-width: 600px; margin: 0 auto; background: white; border-radius: 10px; padding: 30px; }
          .status-badge { display: inline-block; padding: 10px 20px; border-radius: 5px; color: white; font-weight: bold; }
          .status-confirmed { background: #2196F3; }
          .status-in_progress { background: #FF9800; }
          .status-completed { background: #4CAF50; }
          .status-cancelled { background: #f44336; }
          .footer { text-align: center; padding: 20px; color: #666; font-size: 12px; border-top: 1px solid #eee; margin-top: 30px; }
        </style>
      </head>
      <body>
        <div class="container">
          <h1>ØªØ­Ø¯ÙŠØ« Ø­Ø§Ù„Ø© Ø§Ù„Ø·Ù„Ø¨</h1>
          <div style="text-align: center; margin: 20px 0;">
            <span class="status-badge status-${status}">${statusMessages[status]}</span>
          </div>
          <h2>Ù…Ø±Ø­Ø¨Ø§Ù‹ ${user.name}ØŒ</h2>
          <p>${statusMessages[status]} Ø±Ù‚Ù… <strong>${order.order_number}</strong></p>
          <p>Ø§Ù„Ù…Ø²ÙˆØ¯: <strong>${order.vendor_name}</strong></p>
          ${order.vendor_notes ? `<p><strong>Ù…Ù„Ø§Ø­Ø¸Ø§Øª Ø§Ù„Ù…Ø²ÙˆØ¯:</strong> ${order.vendor_notes}</p>` : ''}
          <div class="footer">
            <p>Â© 2024 Nozha 2. Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø­Ù‚ÙˆÙ‚ Ù…Ø­ÙÙˆØ¸Ø©.</p>
          </div>
        </div>
      </body>
      </html>
    `;
    
    return await this.sendEmail({
      to: user.email,
      subject,
      html,
      text: `${statusMessages[status]} Ø±Ù‚Ù… ${order.order_number}`
    });
  }
  
  // â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
  // SUBSCRIPTION EMAILS
  // â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
  
  /**
   * Send subscription expiry warning
   */
  async sendSubscriptionExpiryWarning(vendor, user, daysRemaining) {
    const subject = `âš ï¸ Ø§Ø´ØªØ±Ø§ÙƒÙƒ Ø³ÙŠÙ†ØªÙ‡ÙŠ Ø®Ù„Ø§Ù„ ${daysRemaining} ÙŠÙˆÙ…`;
    
    const html = `
      <!DOCTYPE html>
      <html dir="rtl" lang="ar">
      <head>
        <meta charset="UTF-8">
        <style>
          body { font-family: 'Arial', sans-serif; background-color: #f5f5f5; padding: 20px; }
          .container { max-width: 600px; margin: 0 auto; background: white; border-radius: 10px; padding: 30px; }
          .warning { background: #fff3cd; padding: 20px; border-right: 4px solid #ffc107; margin: 20px 0; }
          .button { display: inline-block; padding: 15px 40px; background: #4CAF50; color: white; text-decoration: none; border-radius: 5px; margin: 20px 0; font-weight: bold; }
          .footer { text-align: center; padding: 20px; color: #666; font-size: 12px; border-top: 1px solid #eee; margin-top: 30px; }
        </style>
      </head>
      <body>
        <div class="container">
          <h1>âš ï¸ ØªÙ†Ø¨ÙŠÙ‡ Ø§Ù†ØªÙ‡Ø§Ø¡ Ø§Ù„Ø§Ø´ØªØ±Ø§Ùƒ</h1>
          <div class="warning">
            <h2>Ù…Ø±Ø­Ø¨Ø§Ù‹ ${user.name}ØŒ</h2>
            <p>Ø§Ø´ØªØ±Ø§ÙƒÙƒ ÙÙŠ Ù†Ø²Ù‡Ø© 2 Ø³ÙŠÙ†ØªÙ‡ÙŠ Ø®Ù„Ø§Ù„ <strong>${daysRemaining} ÙŠÙˆÙ…</strong>.</p>
            <p>ØªØ§Ø±ÙŠØ® Ø§Ù„Ø§Ù†ØªÙ‡Ø§Ø¡: <strong>${vendor.subscription_end}</strong></p>
          </div>
          <p>Ù„Ø¶Ù…Ø§Ù† Ø§Ø³ØªÙ…Ø±Ø§Ø± Ø¸Ù‡ÙˆØ± Ø®Ø¯Ù…Ø§ØªÙƒ Ø¹Ù„Ù‰ Ø§Ù„Ù…Ù†ØµØ©ØŒ ÙŠØ±Ø¬Ù‰ ØªØ¬Ø¯ÙŠØ¯ Ø§Ø´ØªØ±Ø§ÙƒÙƒ Ù‚Ø¨Ù„ Ø§Ù†ØªÙ‡Ø§Ø¡ Ø§Ù„ØµÙ„Ø§Ø­ÙŠØ©.</p>
          <center>
            <a href="${process.env.APP_URL}/subscription/renew" class="button">Ø¬Ø¯Ø¯ Ø§Ø´ØªØ±Ø§ÙƒÙƒ Ø§Ù„Ø¢Ù†</a>
          </center>
          <div class="footer">
            <p>Â© 2024 Nozha 2. Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø­Ù‚ÙˆÙ‚ Ù…Ø­ÙÙˆØ¸Ø©.</p>
          </div>
        </div>
      </body>
      </html>
    `;
    
    return await this.sendEmail({
      to: user.email,
      subject,
      html,
      text: `Ø§Ø´ØªØ±Ø§ÙƒÙƒ Ø³ÙŠÙ†ØªÙ‡ÙŠ Ø®Ù„Ø§Ù„ ${daysRemaining} ÙŠÙˆÙ…. Ø¬Ø¯Ø¯ Ø§Ù„Ø¢Ù†!`
    });
  }
  
  /**
   * Send subscription renewal confirmation
   */
  async sendSubscriptionRenewal(subscription, user) {
    const subject = 'âœ… ØªÙ… ØªØ¬Ø¯ÙŠØ¯ Ø§Ø´ØªØ±Ø§ÙƒÙƒ Ø¨Ù†Ø¬Ø§Ø­';
    
    const html = `
      <!DOCTYPE html>
      <html dir="rtl" lang="ar">
      <head>
        <meta charset="UTF-8">
        <style>
          body { font-family: 'Arial', sans-serif; background-color: #f5f5f5; padding: 20px; }
          .container { max-width: 600px; margin: 0 auto; background: white; border-radius: 10px; padding: 30px; }
          .success { background: #d4edda; padding: 20px; border-right: 4px solid #4CAF50; margin: 20px 0; }
          .footer { text-align: center; padding: 20px; color: #666; font-size: 12px; border-top: 1px solid #eee; margin-top: 30px; }
        </style>
      </head>
      <body>
        <div class="container">
          <h1>âœ… ØªÙ… ØªØ¬Ø¯ÙŠØ¯ Ø§Ù„Ø§Ø´ØªØ±Ø§Ùƒ</h1>
          <div class="success">
            <h2>Ù…Ø±Ø­Ø¨Ø§Ù‹ ${user.name}ØŒ</h2>
            <p>ØªÙ… ØªØ¬Ø¯ÙŠØ¯ Ø§Ø´ØªØ±Ø§ÙƒÙƒ ÙÙŠ Ù†Ø²Ù‡Ø© 2 Ø¨Ù†Ø¬Ø§Ø­!</p>
            <p>Ø§Ù„Ø®Ø·Ø©: <strong>${subscription.plan}</strong></p>
            <p>ØªØ§Ø±ÙŠØ® Ø§Ù„Ø§Ù†ØªÙ‡Ø§Ø¡ Ø§Ù„Ø¬Ø¯ÙŠØ¯: <strong>${subscription.end_date}</strong></p>
          </div>
          <p>Ø´ÙƒØ±Ø§Ù‹ Ù„Ø«Ù‚ØªÙƒ Ø¨Ù†Ø§!</p>
          <div class="footer">
            <p>Â© 2024 Nozha 2. Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø­Ù‚ÙˆÙ‚ Ù…Ø­ÙÙˆØ¸Ø©.</p>
          </div>
        </div>
      </body>
      </html>
    `;
    
    return await this.sendEmail({
      to: user.email,
      subject,
      html,
      text: `ØªÙ… ØªØ¬Ø¯ÙŠØ¯ Ø§Ø´ØªØ±Ø§ÙƒÙƒ Ø¨Ù†Ø¬Ø§Ø­ Ø­ØªÙ‰ ${subscription.end_date}`
    });
  }
}

// Export singleton instance
module.exports = new EmailService();
